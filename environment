#
# Tureba's shell-agnostic environment settings
#
#   To use it, source this from the shell resource files.
#
# who: Arthur Nascimento <tureba@gmail.com>
# where: github.com/tureba/myconfigfiles
#

# let's try an opportunistic color upgrade whenever possible
[ $TERM = xterm -a -f /usr/share/terminfo/x/xterm-256color ] && TERM=xterm-256color
# audio/visual bell be gone
xset -b &>/dev/null

export LC_ALL=C
export LANG=pt_BR.UTF-8
export LANGUAGE=pt_BR.UTF-8

export EDITOR=vim
export PAGER=less
which htop &>/dev/null && alias top=htop

# less, man, most etc colors
export GREP_OPTIONS='--color=auto'
export LESS_TERMCAP_mb=$(tput bold; tput setaf 2)
export LESS_TERMCAP_md=$(tput bold; tput setaf 6)
export LESS_TERMCAP_me=$(tput sgr0)
export LESS_TERMCAP_so=$(tput bold; tput setaf 3; tput setab 4)
export LESS_TERMCAP_se=$(tput rmso; tput sgr0)
export LESS_TERMCAP_us=$(tput smul; tput bold; tput setaf 7)
export LESS_TERMCAP_ue=$(tput rmul; tput sgr0)
export LESS_TERMCAP_mr=$(tput rev)
export LESS_TERMCAP_mh=$(tput dim)
export LESS_TERMCAP_ZN=$(tput ssubm)
export LESS_TERMCAP_ZV=$(tput rsubm)
export LESS_TERMCAP_ZO=$(tput ssupm)
export LESS_TERMCAP_ZW=$(tput rsupm)

# follow the XDG Base and User Directory Specifications
export XDG_DATA_HOME=${XDG_DATA_HOME:-$HOME/.local/share}
export XDG_CONFIG_HOME=${XDG_CONFIG_HOME:-$HOME/.config}
export XDG_CACHE_HOME=${XDG_CACHE_HOME:-$HOME/.cache}
export XDG_DOWNLOAD_DIR=${XDG_DOWNLOAD_DIR:-$HOME/.download}
export XDG_DESKTOP_DIR=${XDG_DESKTOP_DIR:-$HOME}

export INPUTRC=~/.inputrc
export VIMINIT='let $MYVIMRC="$XDG_CONFIG_HOME/vim/vimrc" | source $MYVIMRC'

### setup the key agent ###
SSH_ENV="$HOME/.ssh/environment"

function start_agent {
	echo "Initializing new SSH agent..."
	ssh-agent | sed 's/^echo/#echo/' > "${SSH_ENV}"
	echo succeeded
	chmod 600 "${SSH_ENV}"
}

# Source SSH settings, if applicable
if [ -f "${SSH_ENV}" ]; then
	. "${SSH_ENV}" > /dev/null
	ps -p ${SSH_AGENT_PID} | grep -e 'ssh-agent$' > /dev/null || {
		start_agent;
	}
else
	start_agent;
fi

. "${SSH_ENV}" &>/dev/null
ssh-add -l &>/dev/null || ssh-add ~/.ssh/id_ecdsa ~/.ssh/id_rsa &>/dev/null

